var favObj={temp:{"mangerStatus":false,"shakeAnima":"shake-rotate","sortableClass":"sortable","sortableInt":false,"sync_error_total":0,"iconChange":false,"DATACache":{},"iconHtml":"","nightMode":"day",},DATA:{"version":"0.2","oldDel":[],"oldSort":{},"addIcon":{}},init:function(){var s=this;s.band();if(user_data!=null){s.userManger("sync_init")}s.preprocess()},preprocess:function(){var s=this;if(user_data!=null){s.hideOld();s.showAddIcon();s.sortIcon()}s.dayNight();s.tool.mobileMode()},band:function(){var s=this;$(document).on("change","#web_color",function(){var color=this.value;s.tool.dealBackgroupSHadow("span.show-color",color)});$(document).on("click","#header-box, #nightMode, #add-btn, #reset-btn, #manger-btn, #login-btn, #info-btn, #update_user, #update_wallpaper, #do_reg, #do_login, #logout-btn, #cancel-btn",function(){var id=this.id;if(id=="manger-btn"||id=="cancel-btn"){s.mangerBtn(id)}else{if(id=="reset-btn"){s.resetDefaultIcon()}else{if(id=="add-btn"){s.tool.dealBackgroupSHadow("span.show-color","42, 120, 220");$("#form-add")[0].reset()}else{if($.inArray(id,["logout-btn","do_login","do_reg","update_user","info-btn","update_wallpaper"])!=-1){if(id=="info-btn"){id="user_info"}if(id=="user_info"){s.showModal(id)}return s.userManger(id)}else{if(id=="login-btn"){s.showModal("user")}else{if(id=="nightMode"){var className=$(this).hasClass("rijian")?"rijian":"yejian";s.nightModeSwitch(className)}else{if(id=="header-box"){var $header_wrap=$(".header_wrap");$header_wrap.hasClass("active")?$header_wrap.removeClass("active"):$header_wrap.addClass("active");setTimeout(function(){$("#nightMode").click()},0)}}}}}}}});$(document).on("submit","#form-add",function(event){event.preventDefault();s.addIcon();return false});$(document).on("click","[add_del], [old_del]",function(){var old=$(this).closest("li").attr("data_old")||false;var add=$(this).closest("li").attr("data_add")||false;var type=old>=1?"old":"add";var id=type=="old"?old:add;s.delFavIcon(id,type);return false});$(document).on("click","li[data_add], li[data_old]",function(){var status=s.temp.mangerStatus;if(!status){return true}var old=$(this).attr("data_old")||false;var add=$(this).attr("data_add")||false;if(add>0){return false}s.editIcon(add);return false});$("#b-btn, #q-btn").click(function(){var id=this.id;var urlArr;if(os.isAndroid||os.isPhone){urlArr={"b-btn":"//m.baidu.com/s","q-btn":"//www.google.com/search"}}else{urlArr={"b-btn":"//www.baidu.com/s","q-btn":"//www.google.com/search"}}$("#search-form").attr("action",urlArr[id])});$("#search-form").on("submit",function(){$("#q-word").val($("#b-word").val())})},userManger:function(_type){var s=this;var type=_type||false;if(!type){return false}if(type=="sync_init"){return}else{if(type=="user_info"){var user_info=user_data.user_info;$("#user_info_name").text(user_info.username);$("#user_info_email").text(user_info.email);$("#favorite_total").text($(".recommonds .sigleRecommond:visible").size());var sync_date=user_data.user_data==null?"无":new Date(user_data["user_data"]["data"]["sync_date"]*1000).toLocaleString().replace(/:\d{1,2}$/," ");$("#sync_date").text(sync_date);if(typeof user_info.header_logo_day!="undefined"){$("#header_logo_day").val(user_info.header_logo_day);$("#header_logo_night").val(user_info.header_logo_night);$("#day_pc").val(user_info.day_pc);$("#day_mobile").val(user_info.day_mobile);$("#night_pc").val(user_info.night_pc);$("#night_mobile").val(user_info.night_mobile)}}}var _url="/home/sub";var url,param;if(type=="do_login"){url=_url+"/login";param={"username":$("#username").val(),"password":$("#password").val()};if(param["username"]==""||param["password"]==""){s.showModal("tips","账号/密码不能为空！");return false}}else{if(type=="do_reg"){url=_url+"/reg";param={"username":$("#username1").val(),"password1":$("#password1").val(),"password2":$("#password2").val(),"email":$("#email").val(),"var":$("#var").val()}}else{if(type=="update_user"){url=_url+"/update_pwd";param={"password":$("#password3").val(),"new1":$("#password4").val(),"new2":$("#password5").val()}}else{if(type=="logout-btn"){if(!confirm("确定退出账号吗？")){return false}$.post("/home/sub/out_login",function(){s.showModal("tips","即将刷新页面");setTimeout(function(){location.reload()},1500)})}}}}if(url===undefined){return}$.post(url,param,function(data){if(data.error){s.showModal("tips",data.error);return false}s.showModal("tips",data.msg);if(type=="do_login"){$("#img").attr("src","/home/sub/verify");setTimeout(function(){location.reload()},1500)}else{if(type=="do_reg"){setTimeout(function(){$("#login-btn").click();$("#login-tab").click();$("#username").val(param.username)},1700)}}},"json")},hideOld:function(){var s=this;var delArr=user_data.user_data.data.oldDel;if(delArr.length<1){return false}var del;for(var i in delArr){del=delArr[i];$('[data_old="'+del+'"]').addClass("hide")}},editIcon:function(id){var s=this;if(typeof user_data.user_data.data.addIcon[id]=="undefined"){return false}var param=user_data.user_data.data.addIcon[id];$("#web_url").val(param["web_url"]);
$("#web_name").val(param["web_name"]);$("#web_name2").val(param["web_name2"]);$("#web_color").val(param["web_color"]);$("#web_icon").val(param["web_icon"]);$("#form-add").attr("data_url",param["web_url"]);s.tool.dealBackgroupSHadow("span.show-color",param["web_color"]);$("#editModal").modal("show")},delFavIcon:function(id,_type){if(!confirm("确定要删除该导航吗？")){return false}var s=this;var type=_type=="old"?"old":"add";if(type=="old"){s.DATA.oldDel.push(id);$('[data_old="'+id+'"]').addClass("hide")}else{$.post("/home/sub/del",{"url":id},function(){});$('[data_add="'+id+'"]').remove()}s.saveIconHtml();s.temp.iconChange=true;$("#cancel-btn").addClass("act")},saveIconHtml:function(){var s=this;var iconHtml=s.tool.getIconHtml()},showAddIcon:function(){var s=this;var obj=s.DATA.addIcon;for(var i in obj){s.tool.dealNewIcon(obj[i])}},sortIcon:function(){var s=this;var icon_arr=[],obj={},sort=0;for(var io in user_data.user_data.data.oldSort){if(user_data.user_data.data.oldSort[io]<10000){obj={"sort":sort,"dom":$('[data_old="'+user_data.user_data.data.oldSort[io]+'"]:eq(0)')}}else{obj={"sort":sort,"dom":$('[data_add="'+user_data.user_data.data.oldSort[io]+'"]:eq(0)')}}icon_arr.push(obj);++sort}if(user_data.user_data.data.oldSort.length==""){return false}icon_arr=s.tool.arraySort(icon_arr,"sort",0);var icon_dom_arr=[],$dom;for(var id in icon_arr){$dom=icon_arr[id].dom;icon_dom_arr.push($dom)}$("ul.recommonds>li").remove();$("ul.recommonds").append(icon_dom_arr)},mangerBtn:function(_id){var s=this;var id=_id||null;var status=s.temp.mangerStatus;var anima=s.temp.shakeAnima;var sortableName=s.temp.sortableClass;if(!status){s.temp.DATACache=$.extend(true,{},s.DATA);s.temp.mangerStatus=true;s.temp.iconHtml=$("ul.recommonds").html();$("ul.recommonds").addClass(anima+" "+sortableName);s.dealBandSortable(sortableName);$(".tool-box").addClass("manage");$("#manger-btn").html('<span class="glyphicon glyphicon-ok"></span>').attr("data-original-title","同步 增删改/排序 操作").attr("title","保存结果")}else{if(status||id=="cancel-btn"){s.temp.mangerStatus=false;sortable("."+sortableName,"disable");$("ul.recommonds").removeClass(anima+" "+sortableName);$(".tool-box").removeClass("manage");$("#cancel-btn").removeClass("act");if(id=="cancel-btn"){if(s.temp.iconChange==true){s.dealSortIcon(s.temp.DATACache,2)}s.temp.sortableInt=false}else{if(s.temp.iconChange==true){s.dealSortIcon()}}$("#manger-btn").html('<span class="glyphicon glyphicon-cog"></span>').attr("data-original-title","进入 增删改/排序 操作").attr("title","进入 增删改/排序 操作");s.temp.iconHtml="";s.temp.DATACache={}}}},dealSortIcon:function(_data,_type){var s=this;var type=_type||0;var data=_data||s.DATA;var $icon_arr=$("ul.recommonds>li:not(.hide)");var $icon,flag=false,id=null,old_sort={};s.temp.iconChange=false;if(type==2){$("ul.recommonds").html(s.temp.iconHtml);s.DATA=s.temp.DATACache;return}var sort=[];$icon_arr.each(function(){$icon=$(this);flag=typeof $icon.attr("data_add")!="undefined"&&$icon.attr("data_add").length>1?"add":($icon.attr("data_old")>0?"old":false);if(flag=="add"){id=$icon.attr("data_add");sort.push(id)}else{if(flag=="old"){id=$icon.attr("data_old");sort.push(id)}}});if(type==1){return data}$.post("/home/sub/oldDel",{"sort":JSON.stringify(sort)},function(data){if(data.error){s.showModal("tips",data.error);return false}},"json")},resetDefaultIcon:function(){if(!confirm("确定要恢复所有默认图标和默认排序吗？")){return false}$.post("/home/sub/resetDefaultIcon",{"id":user_data.user_info.id},function(){location.reload()})},addIcon:function(){var param={"web_url":$("#web_url").val(),"web_name":$("#web_name").val(),"web_name2":$("#web_name2").val(),"web_color":$("#web_color").val(),"web_icon":$("#web_icon").val()};var val;for(var i in param){val=$.trim(param[i]);switch(i){case"web_url":var cat=/^(https?|javascript)/;if(!cat.test(val)){alert("网址内容不正确");$("#web_url").focus();return false}break}}for(var i in param){if(param[i]==""&&i!=="web_icon"){alert("每项不能为空");return false}}var yuan=$("#form-add").attr("data_url");var $thisa;var s=this,add_flag=true;if(yuan!=null){param["yuan_url"]=yuan;$thisa=$(".recommonds li[data_add='"+yuan+"']")}else{if(typeof user_data.user_data.data.addIcon[param["web_url"]]!="undefined"){if(!confirm("该网址已添加，确定要覆盖吗？")){return false}add_flag=false;$('li[data_add="'+param["web_url"]+'"]').remove()}else{param.sort=$(".recommonds .sigleRecommond").size()+1}s.tool.dealNewIcon(param,1)}$("#form-add")[0].reset();s.dealBandSortable(s.temp.sortableClass,true);sortable("."+s.temp.sortableClass);$("#editModal").modal("hide");s.temp.iconChange=true;$.post("/home/sub/add_web",param,function(data){if(data.error){s.showModal("tips",data.error);return false}if($thisa!=null){$thisa.attr("data_add",param.web_url);$thisa.children("span").attr("add_del",param.web_url);$thisa.children("a").attr({"href":param.web_url,"title":param.web_name2});$thisa.find(".icon-box").css({"backgroundColor":"rgb("+param.web_color+")","box-shadow":"rgba("+param.web_color+",0.7) 0px 10px 10px -6px"});$thisa.find(".icon-box").text(param.web_name2);
$thisa.find(".text-links").text(param.web_name1)}s.dealSortIcon()})},dealBandSortable:function(className,_flag){var s=this;var flag=_flag||false;if(!flag&&s.temp.sortableInt==true){sortable("."+className,"enable");return}if(flag){sortable("."+className,"destroy")}sortable("."+className,{placeholderClass:"st-move"})[0].addEventListener("sortupdate",function(e){s.temp.iconChange=true;$("#cancel-btn").addClass("act")});s.temp.sortableInt=true},tool:{dealNewIcon:function(param,_type){var type=_type||0;if(param["web_icon"]!=null&&param["web_icon"]!==""){var dom=$("div#tpl-box-2>li.sigleRecommond").clone().attr("data_add",param["web_url"])}else{var dom=$("div#tpl-box>li.sigleRecommond").clone().attr("data_add",param["web_url"])}$("span[add_del]",dom).attr("add_del",param["web_url"]);type==1&&$("span[add_del]",dom).removeClass("hide");$("a.singleLink",dom).attr("href",param["web_url"]).attr("title",param["web_name"]);if(param["web_icon"]!=null&&param["web_icon"]!==""){$("img.img-links2",dom).attr("src",param["web_icon"]);this.dealBackgroupSHadow("img.img-links2",param["web_color"],dom)}else{$("span.icon-box",dom).text(param["web_name2"]);this.dealBackgroupSHadow("span.icon-box",param["web_color"],dom)}$("span.text-links",dom).text(param["web_name"]);$("ul.recommonds").append(dom)},dealBackgroupSHadow:function(selector,color,_dom){var dom=_dom||document;$(selector,dom).css("background-color","rgb("+color+")").css("box-shadow","0 10px 10px -6px rgba("+color+", 0.75")},arraySort:function(arr,sort_field,_type){var sort_field=sort_field||false;if(!sort_field||!$.isArray(arr)){return false}var type=_type||0;if($.inArray(type,[0,1])==-1){type=0}arr.sort(function(a,b){if(typeof a[sort_field]=="undefined"||a[sort_field]<b[sort_field]){return 1}else{if(typeof b[sort_field]=="undefined"||a[sort_field]>b[sort_field]){return -1}}return 0});type==0&&arr.reverse();return arr},getIconHtml:function(){return $("ul.recommonds")[0].outerHTML},tooltip:function(){$('[data-toggle="tooltip"]').tooltip()},mobileMode:function(){var bodyWidth=document.documentElement.clientWidth;if(bodyWidth<900){var initSize=bodyWidth/320*625;document.documentElement.setAttribute("style","font-size: "+initSize+"% !important")}window.onresize=function(){if($("input:focus").length>0){return false}var bodyWidth=document.documentElement.clientWidth;if(bodyWidth<900){var initSize=bodyWidth/320*625;document.documentElement.setAttribute("style","font-size: "+initSize+"% !important")}}}},showModal:function(_title,_content){var s=this;var title=_title||"^_^";if(title==null){return false}else{if(title=="hide"){$("#myModal").modal("hide");return}}$("[modal-title], [modal-body]").addClass("hide");if(title=="tips"){$('[modal-body="'+title+'"]').html(_content)}else{if(title=="setting"){$("#fenyeTwo").val(s.DATA.fenyeTwo);$("#searchFenye").text(s.DATA.fenye);$("#searchType").val(s.DATA.searchType)}}$('[modal-title="'+title+'"], [modal-body="'+title+'"]').removeClass("hide");$("#myModal").modal("show")},dayNight:function(){var s=this,type="day";if(nightMode==null){nightMode={"status":"day"};s.dataMgr("nightMode",nightMode)}else{type=nightMode.status}s.temp.nightMode=type;if(type=="night"){$("#nightMode").click()}},nightModeSwitch:function(className){var s=this;var $bs=$("#bs-css");var $ng=$("#ng-css");var type="day";if(className=="rijian"){$("#nightMode").attr("class","yejian");$("#nightMode").text("夜间模式");$("body").removeClass("night-mode");$bs[0].href=$bs.data("href");setTimeout(function(){if(s.temp.nightMode=="night"){return false}$ng[0].href=""},500)}else{var type="night";$("#nightMode").attr("class","rijian");$("#nightMode").text("日间模式");$("body").addClass("night-mode");$ng[0].href=$ng.data("href");setTimeout(function(){if(s.temp.nightMode=="day"){return false}$bs[0].href=""},1500)}s.temp.nightMode=type}};favObj.init();function addFavorite(){if(window.sidebar&&window.sidebar.addPanel){window.sidebar.addPanel(document.title,window.location.href,"")}else{if(window.external&&("AddFavorite" in window.external)){window.external.AddFavorite(location.href,document.title)}else{if(window.opera&&window.print){this.title=document.title;return true}else{alert("请按 "+(navigator.userAgent.toLowerCase().indexOf("mac")!=-1?"Command/Cmd":"CTRL")+" + D 收藏本页面")}}}}function setHome(obj,vrl){try{obj.style.behavior="url(#default#homepage)";obj.setHomePage(vrl)}catch(e){if(window.netscape){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(e){alert("此操作被浏览器拒绝！\n请在浏览器地址栏输入“about:config”并回车\n然后将 [signed.applets.codebase_principal_support]的值设置为'true',双击即可。")}var prefs=Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch);prefs.setCharPref("browser.startup.homepage",vrl)}else{alert("您的浏览器不支持，请按照下面步骤操作：1.打开浏览器设置；2.点击设置网页；3.输入："+vrl+"点击确定。")}}}var os=function(){var ua=navigator.userAgent,isWindowsPhone=/(?:Windows Phone)/.test(ua),isSymbian=/(?:SymbianOS)/.test(ua)||isWindowsPhone,isAndroid=/(?:Android)/.test(ua),isFireFox=/(?:Firefox)/.test(ua),isChrome=/(?:Chrome|CriOS)/.test(ua),isTablet=/(?:iPad|PlayBook)/.test(ua)||(isAndroid&&!/(?:Mobile)/.test(ua))||(isFireFox&&/(?:Tablet)/.test(ua)),isPhone=/(?:iPhone)/.test(ua)&&!isTablet,isPc=!isPhone&&!isAndroid&&!isSymbian;
return{isTablet:isTablet,isPhone:isPhone,isAndroid:isAndroid,isPc:isPc}}();function formKeyDown(){if($("#search-form").attr("action").indexOf("google")!==-1){$("#q-btn").click()}else{$("#b-btn").click()}};